"(function(){var e,t=this,n=function(){e=new r};Object.defineProperty(t,\"recv\",{enumerable:!0,value:function(){var t,n;return 1===arguments.length?(t=\"*\",n=arguments[0]):(t=arguments[0],n=arguments[1]),e.registerCallback(t,n)}}),Object.defineProperty(t,\"send\",{enumerable:!0,value:function(e,n){var r={type:\"send\",payload:e};t._send(JSON.stringify(r),n||null)}}),Object.defineProperty(t,\"ptr\",{enumerable:!0,value:function(e){return new NativePointer(e)}}),Object.defineProperty(t,\"NULL\",{enumerable:!0,value:new NativePointer(\"0\")}),Object.defineProperty(Memory,\"dup\",{enumerable:!0,value:function(e,t){var n=Memory.alloc(t);return Memory.copy(n,e,t),n}});var r=function(){var e=[],n={},r=function(){t._setIncomingMessageCallback(i)};this.registerCallback=function(e,t){var r=new a(t);return n[e]=r[1],o(),r[0]};var i=function(t){e.push(JSON.parse(t)),o()},o=function(){e.splice(0,e.length).forEach(l)},l=function(t){var r;if(n.hasOwnProperty(t.type))r=t.type;else{if(!n.hasOwnProperty(\"*\"))return void e.push(t);r=\"*\"}var a=n[r];delete n[r],a(t)};r.call(this)},a=function(e){var n=!1;this.wait=function(){for(;!n;)t._waitForEvent()};var r=function(t){e(t),n=!0};return[this,r]};n.call(this)}).call(this),function(){var _runtime=null,_api=null,pointerSize=Process.pointerSize,scratchBuffer=Memory.alloc(pointerSize);Object.defineProperty(this,\"ObjC\",{enumerable:!0,get:function(){return null===_runtime&&(_runtime=new Runtime),_runtime}});var Runtime=function(){var e=null,t=null,n=[],r=function(){e=getApi(),null!==e&&(t=new ClassFactory)};Object.defineProperty(this,\"available\",{enumerable:!0,get:function(){return null!==e}}),Object.defineProperty(this,\"classes\",{enumerable:!0,get:function(){return t.classes}}),Object.defineProperty(this,\"mainQueue\",{enumerable:!0,get:function(){return e._dispatch_main_q}}),this.schedule=function(t,r){var a=this.use(\"NSAutoreleasePool\"),i=new NativeCallback(function(){var e=a.alloc().init(),t=null;try{r()}catch(e){t=e}if(e.release(),setTimeout(function(){n.splice(n.indexOf(i),1)},0),null!==t)throw t},\"void\",[\"pointer\"]);n.push(i),e.dispatch_async_f(t,NULL,i)},this.use=function(e){return t.use(e)},this.cast=function(e,n){return t.cast(e,n)},this.implement=function(e,t){return new NativeCallback(t,e.returnType,e.argumentTypes)},this.refreshClasses=function(){t.refresh()},this.selector=function(t){return e.sel_registerName(Memory.allocUtf8String(t))},this.selectorAsString=function(t){return Memory.readUtf8String(e.sel_getName(t))},r.call(this)},ClassFactory=function ClassFactory(){var factory=this,classNames=[],templateByName={},classByHandle={},msgSendBySignatureId={},api=null,initialize=function(){api=getApi(),this.refresh()};Object.defineProperty(this,\"classes\",{enumerable:!0,get:function(){return classNames}}),this.use=function(e){var t=templateByName[e];if(!t)throw new Error(\"Cannot find class '\"+e+\"'\");if(null===t[1]){var n=ensureClass(t[0],e);t[1]=new n(t[0],null)}return t[1]},this.cast=function(e,t){var n=t.classHandle,r=classByHandle[n];return new r(n,e)},this.refresh=function(){var e=api.objc_getClassList(NULL,0),t=Memory.alloc(e*pointerSize);e=api.objc_getClassList(t,e);for(var n=0,r=0;r!==e;r++){n++;var a=Memory.readPointer(t.add(r*pointerSize)),i=Memory.readUtf8String(api.class_getName(a));templateByName.hasOwnProperty(i)||(templateByName[i]=[a,null],classNames.push(i))}};var ensureClass=function ensureClass(classHandle,cachedName){var handleId=classHandle.toString(),klass=classByHandle[handleId];if(klass)return klass;var name=null!==cachedName?cachedName:Memory.readUtf8String(api.class_getName(classHandle)),superHandle=api.class_getSuperclass(classHandle),superKlass=superHandle.isNull()?null:ensureClass(superHandle,null);eval(\"klass = function \"+name+\"(ch, handle) {\"+(null!==superKlass?\"superKlass.call(this, ch || classHandle, handle);\":\"this.classHandle = ch || classHandle; this.handle = handle || NULL;\")+\"initialize(ch, handle);};\");var initialize=function(){},initializeClass=function(){klass.prototype.toString=function(){return this.description().UTF8String()},addMethods(\"+\"),addMethods(\"-\")},addMethods=function(e){for(var t=api.class_copyMethodList(\"+\"===e?api.object_getClass(classHandle):classHandle,scratchBuffer),n=Memory.readU32(scratchBuffer),r=0;r!==n;r++)addMethod(Memory.readPointer(t.add(r*pointerSize)),e);api.free(t)},addMethod=function addMethod(m,type){try{var sel=api.method_getName(m),name=Memory.readUtf8String(api.sel_getName(sel)),jsName=jsMethodName(name),signature=parseSignature(Memory.readUtf8String(api.method_getTypeEncoding(m))),retType=signature.retType,argTypes=signature.argTypes.slice(2),objc_msgSend=getMsgSendImpl(signature),argVariableNames=argTypes.map(function(e,t){return\"a\"+(t+1)}),callArgs=[\"+\"===type?\"this.classHandle\":\"this.handle\",\"sel\"].concat(argTypes.map(function(e,t){return e.toNative?\"argTypes[\"+t+\"].toNative.call(this, \"+argVariableNames[t]+\")\":argVariableNames[t]})),returnCaptureLeft,returnCaptureRight;\"void\"===retType.type?(returnCaptureLeft=\"\",returnCaptureRight=\"\"):retType.fromNative?(returnCaptureLeft=\"return retType.fromNative.call(this, \",returnCaptureRight=\")\"):(returnCaptureLeft=\"return \",returnCaptureRight=\"\"),eval(\"var f = function (\"+argVariableNames.join(\", \")+\") { \"+returnCaptureLeft+\"objc_msgSend(\"+callArgs.join(\", \")+\")\"+returnCaptureRight+\"; }\"),klass.prototype[jsName]=f,Object.defineProperty(f,\"selector\",{enumerable:!0,value:sel});var implementation=null;Object.defineProperty(f,\"implementation\",{enumerable:!0,get:function(){return new NativeFunction(api.method_getImplementation(m),f.returnType,f.argumentTypes)},set:function(e){implementation=e,api.method_setImplementation(m,e)}}),Object.defineProperty(f,\"returnType\",{enumerable:!0,value:retType.type}),Object.defineProperty(f,\"argumentTypes\",{enumerable:!0,value:signature.argTypes.map(function(e){return e.type})})}catch(e){}},jsMethodName=function(e){for(var t=\"\",n=0;n!==e.length;n++){var r=e.charAt(n);t+=\":\"===r?\"_\":r}return t},parseSignature=function(e){var t=\"\",n=nextType(e),r=parseType(n[0]);t+=r.type;for(var a=[];n[1].length>0;){n=nextType(n[1]);var i=parseType(n[0]);t+=i.type,a.push(i)}return{id:t,retType:r,argTypes:a}},parseType=function(e){for(var t=[];e.length>0;){var n=qualifierById[e[0]];if(!n)break;t.push(n),e=e.substring(1)}var r=converterById[simplifyType(e)];if(!r)throw new Error(\"No parser for type \"+e);return r},simplifyType=function(e){if(\"^\"===e[0])switch(e[1]){case\"[\":case\"{\":case\"(\":return e.substring(0,2)+e.substring(e.length-1)}return e},nextType=function(e){for(var t=\"\",n=0,r=null,a=0,i=!1;n<e.length;){var o=e[n];if(null!==r)t+=o,o===r[0]?a++:o===r[1]&&(a--,0===a&&(r=null));else{var l=e.charCodeAt(n),s=l>=48&&57>=l;if(i){if(!s)break}else i=s,s||(t+=e[n],\"[\"===o?(r=\"[]\",a=1):\"{\"===o?(r=\"{}\",a=1):\"(\"===o&&(r=\"()\",a=1))}n++}return[t,e.substring(n)]},qualifierById={r:\"const\",n:\"in\",N:\"inout\",o:\"out\",O:\"bycopy\",R:\"byref\",V:\"oneway\"},converterById={c:{type:\"char\",fromNative:function(e){return e?!0:!1},toNative:function(e){return e?1:0}},i:{type:\"int\"},q:{type:\"int64\"},C:{type:\"uchar\"},I:{type:\"uint\"},S:{type:\"uint16\"},Q:{type:\"uint64\"},f:{type:\"float\"},d:{type:\"double\"},v:{type:\"void\"},\"*\":{type:\"pointer\",fromNative:function(e){return e.isNull()?null:Memory.readUtf8String(e)}},\"@\":{type:\"pointer\",fromNative:function(e){if(e.isNull())return null;if(e.toString(16)===this.handle.toString(16))return this;var t=api.object_getClass(e),n=ensureClass(t,null);return new n(t,e)},toNative:function(e){return\"string\"==typeof e?factory.use(\"NSString\").stringWithUTF8String_(Memory.allocUtf8String(e)).handle:e}},\"@?\":{type:\"pointer\"},\"#\":{type:\"pointer\"},\":\":{type:\"pointer\"},\"^i\":{type:\"pointer\"},\"^q\":{type:\"pointer\"},\"^S\":{type:\"pointer\"},\"^^S\":{type:\"pointer\"},\"^Q\":{type:\"pointer\"},\"^v\":{type:\"pointer\"},\"^*\":{type:\"pointer\"},\"^@\":{type:\"pointer\"},\"^?\":{type:\"pointer\"},\"^{}\":{type:\"pointer\"}};if(null!==superKlass){var Surrogate=function(){this.constructor=klass};Surrogate.prototype=superKlass.prototype,klass.prototype=new Surrogate,klass.__name__=name,klass.__super__=superKlass.prototype}return initializeClass(),classByHandle[handleId]=klass,klass},getMsgSendImpl=function(e){var t=msgSendBySignatureId[e.id];if(!t){var n=[];e.argTypes.forEach(function(e,t){n.push(e.type),1==t&&n.push(\"...\")}),t=new NativeFunction(api.objc_msgSend,e.retType.type,n),msgSendBySignatureId[e.id]=t}return t};initialize.call(this)},getApi=function(){if(null!==_api)return _api;var e={},t=[{module:\"libsystem_malloc.dylib\",functions:{free:[\"void\",[\"pointer\"]]},variables:{}},{module:\"libobjc.A.dylib\",functions:{objc_msgSend:function(e){this.objc_msgSend=e,this.objc_msgSend_noargs=new NativeFunction(e,\"pointer\",[\"pointer\",\"pointer\",\"...\"])},objc_getClassList:[\"int\",[\"pointer\",\"int\"]],class_getName:[\"pointer\",[\"pointer\"]],class_copyMethodList:[\"pointer\",[\"pointer\",\"pointer\"]],class_getSuperclass:[\"pointer\",[\"pointer\"]],object_getClass:[\"pointer\",[\"pointer\"]],method_getName:[\"pointer\",[\"pointer\"]],method_getTypeEncoding:[\"pointer\",[\"pointer\"]],method_getImplementation:[\"pointer\",[\"pointer\"]],method_setImplementation:[\"pointer\",[\"pointer\",\"pointer\"]],sel_getName:[\"pointer\",[\"pointer\"]],sel_registerName:[\"pointer\",[\"pointer\"]]},variables:{}},{module:\"libdispatch.dylib\",functions:{dispatch_async_f:[\"void\",[\"pointer\",\"pointer\",\"pointer\"]]},variables:{_dispatch_main_q:function(e){this._dispatch_main_q=e}}}],n=0;return t.forEach(function(t){var r=t.functions,a=t.variables;n+=Object.keys(r).length+Object.keys(a).length,Module.enumerateExports(t.module,{onMatch:function(t){var i=t.name;if(\"function\"===t.type){var o=r[i];o&&(\"function\"==typeof o?o.call(e,t.address):e[i]=new NativeFunction(t.address,o[0],o[1]),delete r[i],n--)}else if(\"variable\"===t.type){var l=a[i];l&&(l.call(e,t.address),delete a[i],n--)}return 0===n?\"stop\":void 0},onComplete:function(){}})}),0===n&&(_api=e),_api}}.call(this),function(){function Env(e){this.handle=e}var _runtime=null,_api=null,pointerSize=Process.pointerSize,scratchBuffer=Memory.alloc(pointerSize),JNI_OK=0,JNI_VERSION_1_6=65542,CONSTRUCTOR_METHOD=1,STATIC_METHOD=2,INSTANCE_METHOD=3,JNI_ENV_OFFSET_SELF=12,CLASS_OBJECT_SIZE=160,CLASS_OBJECT_OFFSET_VTABLE_COUNT=112,CLASS_OBJECT_OFFSET_VTABLE=116,OBJECT_OFFSET_CLAZZ=0,METHOD_SIZE=56,METHOD_OFFSET_CLAZZ=0,METHOD_OFFSET_ACCESS_FLAGS=4,METHOD_OFFSET_METHOD_INDEX=8,METHOD_OFFSET_REGISTERS_SIZE=10,METHOD_OFFSET_OUTS_SIZE=12,METHOD_OFFSET_INS_SIZE=14,METHOD_OFFSET_INSNS=32,METHOD_OFFSET_JNI_ARG_INFO=36;Object.defineProperty(this,\"Dalvik\",{enumerable:!0,get:function(){return null===_runtime&&(_runtime=new Runtime),_runtime}});var Runtime=function e(){var t=null,n=null,r=null,a=function(){t=getApi(),null!==t&&(n=new VM(t),r=new ClassFactory(t,n))};WeakRef.bind(e,function(){null!==t&&n.perform(function(){var e=n.getEnv();r.dispose(e),Env.dispose(e)})}),Object.defineProperty(this,\"available\",{enumerable:!0,get:function(){return null!==t}}),this.perform=function(e){if(null===t)throw new Error(\"Dalvik runtime not available\");return n.perform(e)},this.use=function(e){return r.use(e)},this.cast=function(e,t){return r.cast(e,t)},a.call(this)},ClassFactory=function ClassFactory(api,vm){var factory=this,classes={},patchedClasses={},initialize=function(){api=getApi()};this.dispose=function(e){for(var t in patchedClasses)if(patchedClasses.hasOwnProperty(t)){var n=patchedClasses[t];Memory.writePointer(n.vtablePtr,n.vtable),Memory.writeS32(n.vtableCountPtr,n.vtableCount);for(var r in n.targetMethods)n.targetMethods.hasOwnProperty(r)&&(n.targetMethods[r].implementation=null)}patchedClasses={};for(var a in classes)if(classes.hasOwnProperty(a)){var i=classes[a];e.deleteGlobalRef(i.__handle__)}classes={}},this.use=function(e){var t=classes[e];if(!t){var n=vm.getEnv(),r=n.findClass(e.replace(/\\./g,\"/\"));if(r.isNull())throw new Error(\"Class '\"+e+\"' is not loaded\");var a=ensureClass(r,e);t=new a(r,null),n.deleteLocalRef(r)}return t},this.cast=function(e,t){return new t(t.__handle__,e)};var ensureClass=function(classHandle,cachedName){var env=vm.getEnv(),name=null!==cachedName?cachedName:env.getClassName(classHandle),klass=classes[name];if(klass)return klass;var superHandle=env.getSuperclass(classHandle),superKlass;superHandle.isNull()?superKlass=null:(superKlass=ensureClass(superHandle,null),env.deleteLocalRef(superHandle)),eval(\"klass = function \"+basename(name)+\"(classHandle, handle) {var env = vm.getEnv();this.$class = klass;this.$classHandle = env.newGlobalRef(classHandle);this.$handle = (handle !== null) ? env.newGlobalRef(handle) : null;this.$weakRef = WeakRef.bind(this, makeHandleDestructor(this.$handle, this.$classHandle));};\"),classes[name]=klass;var initializeClass=function(){klass.__name__=name,klass.__handle__=env.newGlobalRef(classHandle),klass.prototype.$new=makeConstructor(),klass.prototype.$dispose=dispose,addMethods()},dispose=function(){WeakRef.unbind(this.$weakRef)},makeConstructor=function(){for(var e=env.javaLangReflectConstructor(),t=env.method(\"pointer\",[]),n=[],r=objectType(name,!1),a=t(env.handle,classHandle,env.javaLangClass().getDeclaredConstructors),i=env.getArrayLength(a),o=0;o!==i;o++){var l=env.getObjectArrayElement(a,o),s=env.fromReflectedMethod(l),u=[],p=t(env.handle,l,e.getGenericParameterTypes);env.deleteLocalRef(l);var c=env.getArrayLength(p);try{for(var d=0;d!==c;d++){var f=env.getObjectArrayElement(p,d);try{var h=typeFromClassName(env.getTypeName(f));u.push(h)}finally{env.deleteLocalRef(f)}}}catch(e){continue}finally{env.deleteLocalRef(p)}n.push(makeMethod(CONSTRUCTOR_METHOD,s,r,u))}return env.deleteLocalRef(a),makeMethodDispatcher(\"<init>\",n)},addMethods=function(){for(var e=env.javaLangReflectMethod(),t=env.javaLangReflectModifier(),n=env.method(\"pointer\",[]),r=env.method(\"int32\",[]),a={},i=n(env.handle,classHandle,env.javaLangClass().getDeclaredMethods),o=env.getArrayLength(i),l=0;l!==o;l++){var s=env.getObjectArrayElement(i,l),u=env.fromReflectedMethod(s),p=n(env.handle,s,e.getName),c=n(env.handle,s,e.getGenericReturnType),d=n(env.handle,s,e.getGenericParameterTypes),f=r(env.handle,s,e.getModifiers);env.deleteLocalRef(s);var h,y=env.stringFromJni(p),m=0!==(f&t.STATIC)?STATIC_METHOD:INSTANCE_METHOD,v=[];env.deleteLocalRef(p);try{h=typeFromClassName(env.getTypeName(c))}catch(e){env.deleteLocalRef(d);continue}finally{env.deleteLocalRef(c)}try{for(var g=env.getArrayLength(d),T=0;T!==g;T++){var b=env.getObjectArrayElement(d,T);try{var E=typeFromClassName(env.getTypeName(b));v.push(E)}finally{env.deleteLocalRef(b)}}}catch(e){continue}finally{env.deleteLocalRef(d)}var _;a.hasOwnProperty(y)?_=a[y]:(_=[],a[y]=_),_.push(makeMethod(m,u,h,v))}for(var S in a)if(a.hasOwnProperty(S)){var C=a[S];if(\"valueOf\"===S){var O=C.some(function(e){return e.type===INSTANCE_METHOD&&0===e.argumentTypes.length});if(!O){var M=function(){return this};Object.defineProperty(M,\"holder\",{enumerable:!0,value:klass}),Object.defineProperty(M,\"type\",{enumerable:!0,value:INSTANCE_METHOD}),Object.defineProperty(M,\"returnType\",{enumerable:!0,value:typeFromClassName(\"int\")}),Object.defineProperty(M,\"argumentTypes\",{enumerable:!0,value:[]}),Object.defineProperty(M,\"canInvokeWith\",{enumerable:!0,value:function(e){return 0===e.length}}),C.push(M)}}klass.prototype[S]=makeMethodDispatcher(S,C)}},makeMethodDispatcher=function(e,t){var n={};t.forEach(function(e){var t=e.argumentTypes.length,r=n[t];r||(r=[],n[t]=r),r.push(e)});var r=function(){var r=null!==this.$handle;if(t[0].type!==INSTANCE_METHOD&&r)throw new Error(e+\": cannot call static method by way of an instance\");if(t[0].type===INSTANCE_METHOD&&!r)throw new Error(e+\": cannot call instance method without an instance\");var a=n[arguments.length];if(!a)throw new Error(e+\": argument count does not match any overload\");for(var i=0;i!==a.length;i++){var o=a[i];if(o.canInvokeWith(arguments))return o.apply(this,arguments)}throw new Error(e+\": argument types do not match any overload\")};if(Object.defineProperty(r,\"overloads\",{enumerable:!0,value:t}),Object.defineProperty(r,\"overload\",{enumerable:!0,value:function(){var t=n[arguments.length];if(!t)throw new Error(e+\": argument count does not match any overload\");for(var r=Array.prototype.join.call(arguments,\":\"),a=0;a!==t.length;a++){var i=t[a],o=i.argumentTypes.map(function(e){return e.className}).join(\":\");if(o===r)return i}throw new Error(e+\": specified argument types do not match any overload\")}}),Object.defineProperty(r,\"holder\",{enumerable:!0,get:t[0].holder}),Object.defineProperty(r,\"type\",{enumerable:!0,value:t[0].type}),1===t.length)Object.defineProperty(r,\"implementation\",{enumerable:!0,get:function(){return t[0].implementation},set:function(e){t[0].implementation=e}}),Object.defineProperty(r,\"returnType\",{enumerable:!0,value:t[0].returnType}),Object.defineProperty(r,\"argumentTypes\",{enumerable:!0,value:t[0].argumentTypes}),Object.defineProperty(r,\"canInvokeWith\",{enumerable:!0,value:t[0].canInvokeWith});else{var a=function(){throw new Error(\"Method has more than one overload. Please resolve by for example: `method.overload('int')`\")};Object.defineProperty(r,\"implementation\",{enumerable:!0,get:a,set:a}),Object.defineProperty(r,\"returnType\",{enumerable:!0,get:a}),Object.defineProperty(r,\"argumentTypes\",{enumerable:!0,get:a}),Object.defineProperty(r,\"canInvokeWith\",{enumerable:!0,get:a})}return r},makeMethod=function(type,methodId,retType,argTypes){var targetMethodId=methodId,originalMethodId=null,rawRetType=retType.type,rawArgTypes=argTypes.map(function(e){return e.type}),invokeTarget;type==CONSTRUCTOR_METHOD?invokeTarget=env.constructor(rawArgTypes):type==STATIC_METHOD?invokeTarget=env.staticMethod(rawRetType,rawArgTypes):type==INSTANCE_METHOD&&(invokeTarget=env.method(rawRetType,rawArgTypes));var frameCapacity=2,argVariableNames=argTypes.map(function(e,t){return\"a\"+(t+1)}),callArgs=[\"env.handle\",type===INSTANCE_METHOD?\"this.$handle\":\"this.$classHandle\",\"targetMethodId\"].concat(argTypes.map(function(e,t){return e.toJni?(frameCapacity++,\"argTypes[\"+t+\"].toJni.call(this, \"+argVariableNames[t]+\", env)\"):argVariableNames[t]})),returnCapture,returnStatement;\"void\"===rawRetType?(returnCapture=\"\",returnStatements=\"env.popLocalFrame(NULL);\"):retType.fromJni?(frameCapacity++,returnCapture=\"var rawResult = \",returnStatements=\"var result = retType.fromJni.call(this, rawResult, env);env.popLocalFrame(NULL);return result;\"):(returnCapture=\"var result = \",returnStatements=\"env.popLocalFrame(NULL);return result;\"),eval(\"var f = function (\"+argVariableNames.join(\", \")+\") {var env = vm.getEnv();if (env.pushLocalFrame(\"+frameCapacity+') !== JNI_OK) {env.exceptionClear();throw new Error(\"Out of memory\");}synchronizeVtable.call(this, env);'+returnCapture+\"invokeTarget(\"+callArgs.join(\", \")+\");var throwable = env.exceptionOccurred();if (!throwable.isNull()) {env.exceptionClear();var description = env.method('pointer', [])(env.handle, throwable, env.javaLangObject().toString);var descriptionStr = env.stringFromJni(description);env.popLocalFrame(NULL);throw new Error(descriptionStr);}\"+returnStatements+\"}\"),Object.defineProperty(f,\"holder\",{enumerable:!0,value:klass}),Object.defineProperty(f,\"type\",{enumerable:!0,value:type});var implementation=null,synchronizeVtable=function(e){if(null!==originalMethodId){var t=Memory.readPointer(e.handle.add(JNI_ENV_OFFSET_SELF)),n=api.dvmDecodeIndirectRef(t,this.$handle),r=Memory.readPointer(n.add(OBJECT_OFFSET_CLAZZ)),a=r.toString(16),i=patchedClasses[a];if(!i){var o=r.add(CLASS_OBJECT_OFFSET_VTABLE),l=r.add(CLASS_OBJECT_OFFSET_VTABLE_COUNT),s=Memory.readPointer(o),u=Memory.readS32(l),p=u*pointerSize,c=Memory.alloc(2*p);Memory.copy(c,s,p),Memory.writePointer(o,c),i={classObject:r,vtablePtr:o,vtableCountPtr:l,vtable:s,vtableCount:u,shadowVtable:c,shadowVtableCount:u,targetMethods:{}},patchedClasses[a]=i}a=methodId.toString(16);var d=i.targetMethods[a];if(!d){var h=i.shadowVtableCount++;Memory.writePointer(i.shadowVtable.add(h*pointerSize),targetMethodId),Memory.writeU16(targetMethodId.add(METHOD_OFFSET_METHOD_INDEX),h),Memory.writeS32(i.vtableCountPtr,i.shadowVtableCount),i.targetMethods[a]=f}}};return Object.defineProperty(f,\"implementation\",{enumerable:!0,get:function(){return implementation},set:function(e){if(null!==e||null!==originalMethodId)if(null===originalMethodId&&(originalMethodId=Memory.dup(methodId,METHOD_SIZE),targetMethodId=Memory.dup(methodId,METHOD_SIZE)),null!==e){implementation=implement(f,e);var t=argTypes.reduce(function(e,t){return e+t.size},0);type===INSTANCE_METHOD&&t++;var n=256|Memory.readU32(methodId.add(METHOD_OFFSET_ACCESS_FLAGS)),r=t,a=0,i=t,o=2147483648;Memory.writeU32(methodId.add(METHOD_OFFSET_ACCESS_FLAGS),n),Memory.writeU16(methodId.add(METHOD_OFFSET_REGISTERS_SIZE),r),Memory.writeU16(methodId.add(METHOD_OFFSET_OUTS_SIZE),a),Memory.writeU16(methodId.add(METHOD_OFFSET_INS_SIZE),i),Memory.writeU32(methodId.add(METHOD_OFFSET_JNI_ARG_INFO),o),api.dvmUseJNIBridge(methodId,implementation)}else Memory.copy(methodId,originalMethodId,METHOD_SIZE)}}),Object.defineProperty(f,\"returnType\",{enumerable:!0,value:retType}),Object.defineProperty(f,\"argumentTypes\",{enumerable:!0,value:argTypes}),Object.defineProperty(f,\"canInvokeWith\",{enumerable:!0,value:function(e){return e.length!==argTypes.length?!1:argTypes.every(function(t,n){return t.isCompatible(e[n])})}}),f};if(null!==superKlass){var Surrogate=function(){this.constructor=klass};Surrogate.prototype=superKlass.prototype,klass.prototype=new Surrogate,klass.__super__=superKlass.prototype}else klass.__super__=null;return initializeClass(),klass},makeHandleDestructor=function(){var e=Array.prototype.slice.call(arguments).filter(function(e){return null!==e});return function(){vm.perform(function(){var t=vm.getEnv();e.forEach(t.deleteGlobalRef)})}},implement=function(method,fn){var env=vm.getEnv();if(method.hasOwnProperty(\"overloads\")){if(method.overloads.length>1)throw new Error(\"Method has more than one overload. Please resolve by for example: `method.overload('int')`\");method=method.overloads[0]}var C=method.holder,type=method.type,retType=method.returnType,argTypes=method.argumentTypes,rawRetType=retType.type,rawArgTypes=argTypes.map(function(e){return e.type}),invokeTarget;type==CONSTRUCTOR_METHOD?invokeTarget=env.constructor(rawArgTypes):type==STATIC_METHOD?invokeTarget=env.staticMethod(rawRetType,rawArgTypes):type==INSTANCE_METHOD&&(invokeTarget=env.method(rawRetType,rawArgTypes));var frameCapacity=2,argVariableNames=argTypes.map(function(e,t){return\"a\"+(t+1)}),callArgs=argTypes.map(function(e,t){return e.fromJni?(frameCapacity++,\"argTypes[\"+t+\"].fromJni.call(this, \"+argVariableNames[t]+\", env)\"):argVariableNames[t]}),returnCapture,returnStatement,returnNothing;return\"void\"===rawRetType?(returnCapture=\"\",returnStatements=\"env.popLocalFrame(NULL);\",returnNothing=\"return;\"):retType.toJni?(frameCapacity++,returnCapture=\"var result = \",\"pointer\"===retType.type?(returnStatements=\"var rawResult = retType.toJni.call(this, result, env);return env.popLocalFrame(rawResult);\",returnNothing=\"return NULL;\"):(returnStatements=\"var rawResult = retType.toJni.call(this, result, env);env.popLocalFrame(NULL);return rawResult;\",returnNothing=\"return 0;\")):(returnCapture=\"var result = \",returnStatements=\"env.popLocalFrame(NULL);return result;\",returnNothing=\"return 0;\"),eval(\"var f = function (\"+[\"envHandle\",\"thisHandle\"].concat(argVariableNames).join(\", \")+\") {var env = new Env(envHandle);if (env.pushLocalFrame(\"+frameCapacity+\") !== JNI_OK) {return;}\"+(type===INSTANCE_METHOD?\"var self = new C(C.__handle__, thisHandle);\":\"var self = new C(thisHandle, null);\")+\"try {\"+returnCapture+\"fn.call(\"+[\"self\"].concat(callArgs).join(\", \")+\");} catch (e) {if (typeof e === 'object' && e.hasOwnProperty('$handle')) {env.throw(e.$handle);\"+returnNothing+\"} else {throw e;}}\"+returnStatements+\"}\"),Object.defineProperty(f,\"type\",{enumerable:!0,value:type}),Object.defineProperty(f,\"returnType\",{enumerable:!0,value:retType}),Object.defineProperty(f,\"argumentTypes\",{enumerable:!0,value:argTypes}),Object.defineProperty(f,\"canInvokeWith\",{enumerable:!0,value:function(e){return e.length!==argTypes.length?!1:argTypes.every(function(t,n){return t.isCompatible(e[n])})}}),new NativeCallback(f,rawRetType,[\"pointer\",\"pointer\"].concat(rawArgTypes))},typeFromClassName=function(e){var t=types[e];if(!t){if(0===e.indexOf(\"[\"))throw new Error(\"Unsupported type: \"+e);t=objectType(e,!0)}var n={className:e};for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n},types={boolean:{type:\"uint8\",size:1,isCompatible:function(e){return\"boolean\"==typeof e},fromJni:function(e){return e?!0:!1},toJni:function(e){return e?1:0}},byte:{type:\"int8\",size:1,isCompatible:function(e){return\"number\"==typeof e}},char:{type:\"uint16\",size:1,isCompatible:function(e){return\"string\"==typeof e&&1===e.length},fromJni:function(e){return String.fromCharCode(e)},toJni:function(e){return e.charCodeAt(0)}},short:{type:\"int16\",size:1,isCompatible:function(e){return\"number\"==typeof e}},int:{type:\"int32\",size:1,isCompatible:function(e){return\"number\"==typeof e}},long:{type:\"int64\",size:2,isCompatible:function(e){return\"number\"==typeof e}},float:{type:\"float\",size:1,isCompatible:function(e){return\"number\"==typeof e}},double:{type:\"double\",size:2,isCompatible:function(e){return\"number\"==typeof e}},void:{type:\"void\",size:0,isCompatible:function(){return!1}},\"[B\":{type:\"pointer\",size:1,isCompatible:function(e){return\"object\"==typeof e&&e.hasOwnProperty(\"length\")},fromJni:function(){throw new Error(\"Not yet implemented ([B)\")},toJni:function(){throw new Error(\"Not yet implemented ([B)\")}},\"[C\":{type:\"pointer\",size:1,isCompatible:function(e){return\"object\"==typeof e&&e.hasOwnProperty(\"length\")},fromJni:function(){throw new Error(\"Not yet implemented ([C)\")},toJni:function(){throw new Error(\"Not yet implemented ([C)\")}},\"[I\":{type:\"pointer\",size:1,isCompatible:function(e){return\"object\"==typeof e&&e.hasOwnProperty(\"length\")},fromJni:function(){throw new Error(\"Not yet implemented ([I)\")},toJni:function(){throw new Error(\"Not yet implemented ([I)\")}},\"[Ljava.lang.String;\":{type:\"pointer\",size:1,isCompatible:function(e){return\"object\"==typeof e&&e.hasOwnProperty(\"length\")&&(0===e.length||\"string\"==typeof e[0])},fromJni:function(e,t){for(var n=[],r=t.getArrayLength(e),a=0;a!==r;a++){var i=t.getObjectArrayElement(e,a);n.push(t.stringFromJni(i)),t.deleteLocalRef(i)}return n},toJni:function(e,t){for(var n=t.newObjectArray(e.length,t.javaLangString().handle,NULL),r=0;r!==e.length;r++){var a=t.newStringUtf(e[r]);t.setObjectArrayElement(n,r,a),t.deleteLocalRef(a)}return n}}},objectType=function(e,t){return{type:\"pointer\",size:1,isCompatible:function(t){return\"java.lang.String\"===e&&\"string\"==typeof t?!0:\"object\"==typeof t&&t.hasOwnProperty(\"$handle\")},fromJni:function(n,r){return n.isNull()?null:\"java.lang.String\"===e&&t?r.stringFromJni(n):null!==this.$handle&&r.isSameObject(n,this.$handle)?this:factory.cast(n,factory.use(e))},toJni:function(e,t){return\"string\"==typeof e?t.newStringUtf(e):e.$handle}}};initialize.call(this)},VM=function(e){var t=null,n=null,r=null,a=null,i=function(){t=Memory.readPointer(e.gDvmJni.add(8));var i=Memory.readPointer(t);n=new NativeFunction(Memory.readPointer(i.add(4*pointerSize)),\"int32\",[\"pointer\",\"pointer\",\"pointer\"]),r=new NativeFunction(Memory.readPointer(i.add(5*pointerSize)),\"int32\",[\"pointer\"]),a=new NativeFunction(Memory.readPointer(i.add(6*pointerSize)),\"int32\",[\"pointer\",\"pointer\",\"int32\"])};this.perform=function(e){var t=this.tryGetEnv(),n=null!==t;n||(t=this.attachCurrentThread());var r,a=null;try{r=e()}catch(e){a=e}if(n||this.detachCurrentThread(),null!==a)throw a;return r},this.attachCurrentThread=function(){return checkJniResult(\"VM::AttachCurrentThread\",n(t,scratchBuffer,NULL)),new Env(Memory.readPointer(scratchBuffer))},this.detachCurrentThread=function(){checkJniResult(\"VM::DetachCurrentThread\",r(t))},this.getEnv=function(){return checkJniResult(\"VM::GetEnv\",a(t,scratchBuffer,JNI_VERSION_1_6)),new Env(Memory.readPointer(scratchBuffer))},this.tryGetEnv=function(){var e=a(t,scratchBuffer,JNI_VERSION_1_6);return e!==JNI_OK?null:new Env(Memory.readPointer(scratchBuffer))},i.call(this)};!function(){function e(e){return N.push(e),e}function t(){return null===M&&(M=Memory.readPointer(this.handle)),M}function n(e,n,r,a){var i=null;return function(){null===i&&(i=new NativeFunction(Memory.readPointer(t.call(this).add(e*pointerSize)),n,r));var o=[i];return o=o.concat.apply(o,arguments),a.apply(this,o)}}var r=28,a=34,i=37,o=40,l=43,s=46,u=49,p=52,c=55,d=58,f=61,h=114,y=117,m=120,v=123,g=126,T=129,b=132,E=135,_=138,S=141,C={pointer:a,uint8:i,int8:o,uint16:l,int16:s,int32:u,int64:p,float:c,double:d,void:f},O={pointer:h,uint8:y,int8:m,uint16:v,int16:g,int32:T,int64:b,float:E,double:_,void:S},M=null,N=[];Env.dispose=function(e){N.forEach(e.deleteGlobalRef),N=[]},Env.prototype.findClass=n(6,\"pointer\",[\"pointer\",\"pointer\"],function(e,t){return e(this.handle,Memory.allocUtf8String(t))}),Env.prototype.fromReflectedMethod=n(7,\"pointer\",[\"pointer\",\"pointer\"],function(e,t){return e(this.handle,t)}),Env.prototype.getSuperclass=n(10,\"pointer\",[\"pointer\",\"pointer\"],function(e,t){return e(this.handle,t)}),Env.prototype.throw=n(13,\"int32\",[\"pointer\",\"pointer\"],function(e,t){return e(this.handle,t)}),Env.prototype.exceptionOccurred=n(15,\"pointer\",[\"pointer\"],function(e){return e(this.handle)}),Env.prototype.exceptionDescribe=n(16,\"void\",[\"pointer\"],function(e){e(this.handle)}),Env.prototype.exceptionClear=n(17,\"void\",[\"pointer\"],function(e){e(this.handle)}),Env.prototype.pushLocalFrame=n(19,\"int32\",[\"pointer\",\"int32\"],function(e,t){return e(this.handle,t)}),Env.prototype.popLocalFrame=n(20,\"pointer\",[\"pointer\",\"pointer\"],function(e,t){return e(this.handle,t)}),Env.prototype.newGlobalRef=n(21,\"pointer\",[\"pointer\",\"pointer\"],function(e,t){return e(this.handle,t)}),Env.prototype.deleteGlobalRef=n(22,\"void\",[\"pointer\",\"pointer\"],function(e,t){e(this.handle,t)}),Env.prototype.deleteLocalRef=n(23,\"void\",[\"pointer\",\"pointer\"],function(e,t){e(this.handle,t)}),Env.prototype.isSameObject=n(24,\"uint8\",[\"pointer\",\"pointer\",\"pointer\"],function(e,t,n){return e(this.handle,t,n)?!0:!1}),Env.prototype.isInstanceOf=n(32,\"uint8\",[\"pointer\",\"pointer\",\"pointer\"],function(e,t,n){return e(this.handle,t,n)?!0:!1}),Env.prototype.getMethodId=n(33,\"pointer\",[\"pointer\",\"pointer\",\"pointer\",\"pointer\"],function(e,t,n,r){return e(this.handle,t,Memory.allocUtf8String(n),Memory.allocUtf8String(r))}),Env.prototype.getFieldId=n(94,\"pointer\",[\"pointer\",\"pointer\",\"pointer\",\"pointer\"],function(e,t,n,r){return e(this.handle,t,Memory.allocUtf8String(n),Memory.allocUtf8String(r))}),Env.prototype.getIntField=n(100,\"int32\",[\"pointer\",\"pointer\",\"pointer\"],function(e,t,n){return e(this.handle,t,n)}),Env.prototype.getStaticMethodId=n(113,\"pointer\",[\"pointer\",\"pointer\",\"pointer\",\"pointer\"],function(e,t,n,r){return e(this.handle,t,Memory.allocUtf8String(n),Memory.allocUtf8String(r))}),Env.prototype.getStaticFieldId=n(144,\"pointer\",[\"pointer\",\"pointer\",\"pointer\",\"pointer\"],function(e,t,n,r){return e(this.handle,t,Memory.allocUtf8String(n),Memory.allocUtf8String(r))}),Env.prototype.getStaticIntField=n(150,\"int32\",[\"pointer\",\"pointer\",\"pointer\"],function(e,t,n){return e(this.handle,t,n)}),Env.prototype.newStringUtf=n(167,\"pointer\",[\"pointer\",\"pointer\"],function(e,t){var n=Memory.allocUtf8String(t);return e(this.handle,n)}),Env.prototype.getStringUtfChars=n(169,\"pointer\",[\"pointer\",\"pointer\",\"pointer\"],function(e,t){return e(this.handle,t,NULL)}),Env.prototype.releaseStringUtfChars=n(170,\"void\",[\"pointer\",\"pointer\",\"pointer\"],function(e,t,n){e(this.handle,t,n)}),Env.prototype.getArrayLength=n(171,\"int32\",[\"pointer\",\"pointer\"],function(e,t){return e(this.handle,t)}),Env.prototype.newObjectArray=n(172,\"pointer\",[\"pointer\",\"int32\",\"pointer\",\"pointer\"],function(e,t,n,r){return e(this.handle,t,n,r)}),Env.prototype.getObjectArrayElement=n(173,\"pointer\",[\"pointer\",\"pointer\",\"int32\"],function(e,t,n){return e(this.handle,t,n)}),Env.prototype.setObjectArrayElement=n(174,\"void\",[\"pointer\",\"pointer\",\"int32\",\"pointer\"],function(e,t,n,r){e(this.handle,t,n,r)"
"});var w={},I=function(e,n,r){var a=e+\"|\"+n+\"|\"+r.join(\":\"),i=w[a];return i||(i=new NativeFunction(Memory.readPointer(t.call(this).add(e*pointerSize)),n,[\"pointer\",\"pointer\",\"pointer\",\"...\"].concat(r)),w[a]=i),i};Env.prototype.constructor=function(e){return I(r,\"pointer\",e)},Env.prototype.method=function(e,t){var n=C[e];if(void 0===n)throw new Error(\"Unsupported type: \"+e);return I(n,e,t)},Env.prototype.staticMethod=function(e,t){var n=O[e];if(void 0===n)throw new Error(\"Unsupported type: \"+e);return I(n,e,t)};var j=null;Env.prototype.javaLangClass=function(){if(null===j){var t=this.findClass(\"java/lang/Class\");j={handle:e(this.newGlobalRef(t)),getName:this.getMethodId(t,\"getName\",\"()Ljava/lang/String;\"),getDeclaredConstructors:this.getMethodId(t,\"getDeclaredConstructors\",\"()[Ljava/lang/reflect/Constructor;\"),getDeclaredMethods:this.getMethodId(t,\"getDeclaredMethods\",\"()[Ljava/lang/reflect/Method;\")},this.deleteLocalRef(t)}return j};var L=null;Env.prototype.javaLangObject=function(){if(null===L){var e=this.findClass(\"java/lang/Object\");L={toString:this.getMethodId(e,\"toString\",\"()Ljava/lang/String;\")},this.deleteLocalRef(e)}return L};var F=null;Env.prototype.javaLangReflectConstructor=function(){if(null===F){var e=this.findClass(\"java/lang/reflect/Constructor\");F={getGenericParameterTypes:this.getMethodId(e,\"getGenericParameterTypes\",\"()[Ljava/lang/reflect/Type;\")},this.deleteLocalRef(e)}return F};var P=null;Env.prototype.javaLangReflectMethod=function(){if(null===P){var e=this.findClass(\"java/lang/reflect/Method\");P={getName:this.getMethodId(e,\"getName\",\"()Ljava/lang/String;\"),getGenericParameterTypes:this.getMethodId(e,\"getGenericParameterTypes\",\"()[Ljava/lang/reflect/Type;\"),getGenericReturnType:this.getMethodId(e,\"getGenericReturnType\",\"()Ljava/lang/reflect/Type;\"),getModifiers:this.getMethodId(e,\"getModifiers\",\"()I\")},this.deleteLocalRef(e)}return P};var R=null;Env.prototype.javaLangReflectModifier=function(){if(null===R){var e=this.findClass(\"java/lang/reflect/Modifier\");R={PUBLIC:this.getStaticIntField(e,this.getStaticFieldId(e,\"PUBLIC\",\"I\")),PRIVATE:this.getStaticIntField(e,this.getStaticFieldId(e,\"PRIVATE\",\"I\")),PROTECTED:this.getStaticIntField(e,this.getStaticFieldId(e,\"PROTECTED\",\"I\")),STATIC:this.getStaticIntField(e,this.getStaticFieldId(e,\"STATIC\",\"I\"))},this.deleteLocalRef(e)}return R};var A=null;Env.prototype.javaLangReflectGenericArrayType=function(){if(null===A){var t=this.findClass(\"java/lang/reflect/GenericArrayType\");A={handle:e(this.newGlobalRef(t)),getGenericComponentType:this.getMethodId(t,\"getGenericComponentType\",\"()Ljava/lang/reflect/Type;\")},this.deleteLocalRef(t)}return A},Env.prototype.getClassName=function(e){var t=this.method(\"pointer\",[])(this.handle,e,this.javaLangClass().getName),n=this.stringFromJni(t);return this.deleteLocalRef(t),n},Env.prototype.getTypeName=function(e){return this.isInstanceOf(e,this.javaLangClass().handle)?this.getClassName(e):\"java/lang/Object\"},Env.prototype.stringFromJni=function(e){var t=this.getStringUtfChars(e),n=Memory.readUtf8String(t);return this.releaseStringUtfChars(e,t),n}}();var getApi=function(){if(null!==_api)return _api;var e={},t=[{module:\"libdvm.so\",functions:{_Z20dvmDecodeIndirectRefP6ThreadP8_jobject:[\"dvmDecodeIndirectRef\",\"pointer\",[\"pointer\",\"pointer\"]],_Z15dvmUseJNIBridgeP6MethodPv:[\"dvmUseJNIBridge\",\"void\",[\"pointer\",\"pointer\"]]},variables:{gDvmJni:function(e){this.gDvmJni=e}}}],n=0;return t.forEach(function(t){var r=t.functions,a=t.variables;n+=Object.keys(r).length+Object.keys(a).length,Module.enumerateExports(t.module,{onMatch:function(t){var i=t.name;if(\"function\"===t.type){var o=r[i];o&&(\"function\"==typeof o?o.call(e,t.address):e[o[0]]=new NativeFunction(t.address,o[1],o[2]),delete r[i],n--)}else if(\"variable\"===t.type){var l=a[i];l&&(l.call(e,t.address),delete a[i],n--)}return 0===n?\"stop\":void 0},onComplete:function(){}})}),0===n&&(_api=e),_api},checkJniResult=function(e,t){if(t!=JNI_OK)throw new Error(e+\" failed: \"+t)},basename=function(e){return e.slice(e.lastIndexOf(\".\")+1)}}.call(this);"
