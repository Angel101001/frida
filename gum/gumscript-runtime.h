"(function(){var e=this,t=null,n=function n(){t=new r};Object.defineProperty(e,\"recv\",{enumerable:!0,value:function(){var e,n;return 1===arguments.length?(e=\"*\",n=arguments[0]):(e=arguments[0],n=arguments[1]),t.registerCallback(e,n)}}),Object.defineProperty(e,\"send\",{enumerable:!0,value:function(t,n){var r={type:\"send\",payload:t};e._send(JSON.stringify(r),n||null)}}),Object.defineProperty(e,\"ptr\",{enumerable:!0,value:function(e){return new NativePointer(e)}});var r=function r(){var t=[],n={},r=function r(){e._setIncomingMessageCallback(i)};this.registerCallback=function(e,t){var r=new a(t);return n[e]=r[1],s(),r[0]};var i=function i(e){t.push(JSON.parse(e)),s()},s=function s(){t.splice(0,t.length).forEach(o)},o=function o(e){var r;if(n.hasOwnProperty(e.type))r=e.type;else{if(!n.hasOwnProperty(\"*\"))return t.push(e),void 0;r=\"*\"}var a=n[r];delete n[r],a(e)};r.call(this)},a=function a(t){var n=!1;this.wait=function(){for(;!n;)e._waitForEvent()};var r=function r(e){t(e),n=!0};return[this,r]};n.call(this)}).call(this),function(){var _runtime=null,_api=null,pointerSize=\"x64\"===Process.arch?8:4,scratchBuffer=Memory.alloc(pointerSize);Object.defineProperty(this,\"ObjC\",{enumerable:!0,get:function(){return null===_runtime&&(_runtime=new Runtime),_runtime}});var Runtime=function Runtime(){var e=null,t=null,n=[],r=function r(){e=getApi(),null!==e&&(t=new ClassFactory)};Object.defineProperty(this,\"available\",{enumerable:!0,get:function(){return null!==e}}),Object.defineProperty(this,\"classes\",{enumerable:!0,get:function(){return t.classes}}),Object.defineProperty(this,\"mainQueue\",{enumerable:!0,get:function(){return e._dispatch_main_q}}),this.schedule=function(t,r){var a=this.use(\"NSAutoreleasePool\"),i=new NativeCallback(function(){var e=a.alloc().init(),t=null;try{r()}catch(s){t=s}if(e.release(),setTimeout(function(){n.splice(n.indexOf(i),1)},0),null!==t)throw t},\"void\",[\"pointer\"]);n.push(i),e.dispatch_async_f(t,ptr(\"0\"),i)},this.use=function(e){return t.use(e)},this.cast=function(e,n){return t.cast(e,n)},this.implement=function(e,t){return new NativeCallback(t,e.returnType,e.argumentTypes)},this.refreshClasses=function(){t.refresh()},this.selector=function(t){return e.sel_registerName(Memory.allocUtf8String(t))},this.selectorAsString=function(t){return Memory.readUtf8String(e.sel_getName(t))},r.call(this)},ClassFactory=function ClassFactory(){var factory=this,classNames=[],templateByName={},classByHandle={},msgSendBySignatureId={},api=null,initialize=function initialize(){api=getApi(),this.refresh()};Object.defineProperty(this,\"classes\",{enumerable:!0,get:function(){return classNames}}),this.use=function use(e){var t=templateByName[e];if(!t)throw Error(\"Cannot find class '\"+e+\"'\");if(null===t[1]){var n=ensureClass(t[0],e);t[1]=new n(t[0],null)}return t[1]},this.cast=function cast(e,t){var n=t.classHandle,r=classByHandle[n];return new r(n,e)},this.refresh=function refresh(){var e=api.objc_getClassList(ptr(\"0\"),0),t=Memory.alloc(e*pointerSize);e=api.objc_getClassList(t,e);for(var n=0,r=0;r!==e;r++){n++;var a=Memory.readPointer(t.add(r*pointerSize)),i=Memory.readUtf8String(api.class_getName(a));templateByName.hasOwnProperty(i)||(templateByName[i]=[a,null],classNames.push(i))}};var ensureClass=function ensureClass(classHandle,cachedName){var handleId=\"\"+classHandle,klass=classByHandle[handleId];if(klass)return klass;var name=null!==cachedName?cachedName:Memory.readUtf8String(api.class_getName(classHandle)),superHandle=api.class_getSuperclass(classHandle),superKlass=\"0\"!==superHandle.toString(16)?ensureClass(superHandle,null):null;eval(\"klass = function \"+name+\"(ch, handle) {\"+(null!==superKlass?\"superKlass.call(this, ch || classHandle, handle);\":'this.classHandle = ch || classHandle; this.handle = handle || ptr(\"0\");')+\"initialize(ch, handle);\"+\"};\");var initialize=function initialize(){},initializeClass=function initializeClass(){klass.prototype.toString=function(){return this.description().UTF8String()},addMethods(\"+\"),addMethods(\"-\")},addMethods=function addMethods(e){for(var t=api.class_copyMethodList(\"+\"===e?api.object_getClass(classHandle):classHandle,scratchBuffer),n=Memory.readU32(scratchBuffer),r=0;r!==n;r++)addMethod(Memory.readPointer(t.add(r*pointerSize)),e);api.free(t)},addMethod=function addMethod(m,type){try{var sel=api.method_getName(m),name=Memory.readUtf8String(api.sel_getName(sel)),jsName=jsMethodName(name),signature=parseSignature(Memory.readUtf8String(api.method_getTypeEncoding(m))),retType=signature.retType,argTypes=signature.argTypes.slice(2),objc_msgSend=getMsgSendImpl(signature),argVariableNames=argTypes.map(function(e,t){return\"a\"+(t+1)}),callArgs=[\"+\"===type?\"this.classHandle\":\"this.handle\",\"sel\"].concat(argTypes.map(function(e,t){return e.toNative?\"argTypes[\"+t+\"].toNative.call(this, \"+argVariableNames[t]+\")\":argVariableNames[t]})),returnCaptureLeft,returnCaptureRight;\"void\"===retType.type?(returnCaptureLeft=\"\",returnCaptureRight=\"\"):retType.fromNative?(returnCaptureLeft=\"return retType.fromNative.call(this, \",returnCaptureRight=\")\"):(returnCaptureLeft=\"return \",returnCaptureRight=\"\"),eval(\"var f = function (\"+argVariableNames.join(\", \")+\") { \"+returnCaptureLeft+\"objc_msgSend(\"+callArgs.join(\", \")+\")\"+returnCaptureRight+\";\"+\" }\"),klass.prototype[jsName]=f,Object.defineProperty(f,\"selector\",{enumerable:!0,value:sel}),Object.defineProperty(f,\"implementation\",{enumerable:!0,get:function(){return new NativeFunction(api.method_getImplementation(m),f.returnType,f.argumentTypes)},set:function(e){api.method_setImplementation(m,e)}}),Object.defineProperty(f,\"returnType\",{enumerable:!0,value:retType.type}),Object.defineProperty(f,\"argumentTypes\",{enumerable:!0,value:signature.argTypes.map(function(e){return e.type})})}catch(e){}},jsMethodName=function jsMethodName(e){for(var t=\"\",n=0;n!==e.length;n++){var r=e.charAt(n);t+=\":\"===r?\"_\":r}return t},parseSignature=function parseSignature(e){var t=\"\",n=nextType(e),r=parseType(n[0]);t+=r.type;for(var a=[];n[1].length>0;){n=nextType(n[1]);var i=parseType(n[0]);t+=i.type,a.push(i)}return{id:t,retType:r,argTypes:a}},parseType=function parseType(e){for(var t=[];e.length>0;){var n=qualifierById[e[0]];if(!n)break;t.push(n),e=e.substring(1)}var r=converterById[simplifyType(e)];if(!r)throw Error(\"No parser for type \"+e);return r},simplifyType=function simplifyType(e){if(\"^\"===e[0])switch(e[1]){case\"[\":case\"{\":case\"(\":return e.substring(0,2)+e.substring(e.length-1)}return e},nextType=function nextType(e){for(var t=\"\",n=0,r=null,a=0,i=!1;e.length>n;){var s=e[n];if(null!==r)t+=s,s===r[0]?a++:s===r[1]&&(a--,0===a&&(r=null));else{var o=e.charCodeAt(n),l=o>=48&&57>=o;if(i){if(!l)break}else i=l,l||(t+=e[n],\"[\"===s?(r=\"[]\",a=1):\"{\"===s?(r=\"{}\",a=1):\"(\"===s&&(r=\"()\",a=1))}n++}return[t,e.substring(n)]},qualifierById={r:\"const\",n:\"in\",N:\"inout\",o:\"out\",O:\"bycopy\",R:\"byref\",V:\"oneway\"},converterById={c:{type:\"char\",fromNative:function(e){return e?!0:!1},toNative:function(e){return e?1:0}},i:{type:\"int\"},q:{type:\"int64\"},C:{type:\"uchar\"},I:{type:\"uint\"},S:{type:\"uint16\"},Q:{type:\"uint64\"},f:{type:\"float\"},d:{type:\"double\"},v:{type:\"void\"},\"*\":{type:\"pointer\",fromNative:function(e){return\"0\"===e.toString(16)?null:Memory.readUtf8String(e)}},\"@\":{type:\"pointer\",fromNative:function(e){if(\"0\"===e.toString(16))return null;if(e.toString(16)===this.handle.toString(16))return this;var t=api.object_getClass(e),n=ensureClass(t,null);return new n(t,e)},toNative:function(e){return\"string\"==typeof e?factory.use(\"NSString\").stringWithUTF8String_(Memory.allocUtf8String(e)).handle:e}},\"@?\":{type:\"pointer\"},\"#\":{type:\"pointer\"},\":\":{type:\"pointer\"},\"^i\":{type:\"pointer\"},\"^q\":{type:\"pointer\"},\"^S\":{type:\"pointer\"},\"^^S\":{type:\"pointer\"},\"^Q\":{type:\"pointer\"},\"^v\":{type:\"pointer\"},\"^*\":{type:\"pointer\"},\"^@\":{type:\"pointer\"},\"^?\":{type:\"pointer\"},\"^{}\":{type:\"pointer\"}};if(null!==superKlass){var Surrogate=function(){this.constructor=klass};Surrogate.prototype=superKlass.prototype,klass.prototype=new Surrogate,klass.__name__=name,klass.__super__=superKlass.prototype}return initializeClass(),classByHandle[handleId]=klass,klass},getMsgSendImpl=function getMsgSendImpl(e){var t=msgSendBySignatureId[e.id];if(!t){var n=[];e.argTypes.forEach(function(e,t){n.push(e.type),1==t&&n.push(\"...\")}),t=new NativeFunction(api.objc_msgSend,e.retType.type,n),msgSendBySignatureId[e.id]=t}return t};initialize.call(this)},getApi=function(){if(null!==_api)return _api;var e={},t=[{module:\"libsystem_malloc.dylib\",functions:{free:[\"void\",[\"pointer\"]]},variables:{}},{module:\"libobjc.A.dylib\",functions:{objc_msgSend:function(e){this.objc_msgSend=e,this.objc_msgSend_noargs=new NativeFunction(e,\"pointer\",[\"pointer\",\"pointer\",\"...\"])},objc_getClassList:[\"int\",[\"pointer\",\"int\"]],class_getName:[\"pointer\",[\"pointer\"]],class_copyMethodList:[\"pointer\",[\"pointer\",\"pointer\"]],class_getSuperclass:[\"pointer\",[\"pointer\"]],object_getClass:[\"pointer\",[\"pointer\"]],method_getName:[\"pointer\",[\"pointer\"]],method_getTypeEncoding:[\"pointer\",[\"pointer\"]],method_getImplementation:[\"pointer\",[\"pointer\"]],method_setImplementation:[\"pointer\",[\"pointer\",\"pointer\"]],sel_getName:[\"pointer\",[\"pointer\"]],sel_registerName:[\"pointer\",[\"pointer\"]]},variables:{}},{module:\"libdispatch.dylib\",functions:{dispatch_async_f:[\"void\",[\"pointer\",\"pointer\",\"pointer\"]]},variables:{_dispatch_main_q:function(e){this._dispatch_main_q=e}}}],n=0;return t.forEach(function(t){var r=t.functions,a=t.variables;n+=Object.keys(r).length+Object.keys(a).length,Module.enumerateExports(t.module,{onMatch:function(t){var i=t.name;if(\"function\"===t.type){var s=r[i];s&&(\"function\"==typeof s?s.call(e,t.address):e[i]=new NativeFunction(t.address,s[0],s[1]),delete r[i],n--)}else if(\"variable\"===t.type){var o=a[i];o&&(o.call(e,t.address),delete a[i],n--)}return 0===n?\"stop\":void 0},onComplete:function(){}})}),0===n&&(_api=e),_api}}.call(this);"
